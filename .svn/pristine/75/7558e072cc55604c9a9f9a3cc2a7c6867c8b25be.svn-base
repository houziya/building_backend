<?php

namespace backend\controllers;

use common\models\ZyrjCash;
use common\models\ZyrjCashSearch;
use common\models\ZyrjFck;
use common\models\ZyrjFee;
use Yii;

class OrderController extends \yii\web\Controller
{
    public function actionBuyList()
    {
        $searchModel = new ZyrjCashSearch();
        $dataProvider = $searchModel->search(Yii::$app->request->queryParams);

        $configParams = ZyrjFee::findOne(["id"=>1]);
        return $this->render('buy-list', [
            'searchModel' => $searchModel,
            'dataProvider' => $dataProvider,
            's12' => $configParams["s12"],
        ]);
    }

    public function actionDelete()
    {
        $orderId = intval(Yii::$app->request->get("id"));
        $orderInfo = ZyrjCash::findOne(["id" => $orderId]);
        if ((time() - $orderInfo["rdt"]) >= 24 * 3600) {
            //return $this->redirect("buy-list");
        }
        print_r($orderInfo);
        if ($orderInfo['money_type'] == 2) {
            //减少挂卖金额
            echo $orderInfo['uid'];exit;
            $memberModel = ZyrjFck::findOne($orderInfo['uid']);
            $memberModel->xx_money -= $orderInfo['money'];
            $memberModel->save();
            //$fck->execute("update __TABLE__ set xx_money=xx_money-" . $cash_rs['money'] . " where id=" . $cash_rs['uid']);
        }
    }
}
